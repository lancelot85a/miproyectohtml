<!DOCTYPE html>
<html lang="es">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Analizador VAK Mejorado con TextRazor</title>
	<style>
		/* Variables de color */
		:root {
			--visual-color: #0040ff;
			/* Azul */
			--auditory-color: #a10303;
			/* Rojo */
			--kinesthetic-color: #017564;
			/* Verde */
			--auditory-digital-color: #ff8c00;
			/* Naranja */
			--entity-color: #8e44ad;
			/* Morado */
			--neutral-color: #2c3e50;
			/* Color neutro */
			--bg-color: #f4f4f4;
			--text-color: #2c3e50;
			--header-bg: #ffffff;
			--card-bg: #fff;
			--tooltip-bg: rgba(0, 0, 0, 0.8);
			--tooltip-text: #fff;
			--button-hover: #8e44ad;
			--modal-bg: rgba(0, 0, 0, 0.5);
			--focus-outline: #3498db;
			--transition-speed: 0.3s;
			--title-font-size: 2.5em;
			--title-font-family: 'Verdana', sans-serif;
			--title-letter-spacing: 2px;
			--accordion-bg: #f9f9f9;
		}

		.dark-mode {
			--bg-color: #2c3e50;
			--text-color: #ecf0f1;
			--header-bg: #34495e;
			--card-bg: #2c3e50;
			--tooltip-bg: rgba(255, 255, 255, 0.9);
			--tooltip-text: #2c3e50;
			--button-hover: #5e2a7f;
			--accordion-bg: #34495e;
		}

		body {
			font-family: 'Verdana', sans-serif;
			line-height: 1.6;
			color: var(--text-color);
			margin: 0;
			padding: 0;
			background-color: var(--bg-color);
			transition: background-color var(--transition-speed) ease, color var(--transition-speed) ease;
		}

		.container {
			max-width: 1400px;
			margin: 0 auto;
			background-color: var(--card-bg);
			border-radius: 10px;
			box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
			overflow: hidden;
			padding: 20px;
			transition: background-color var(--transition-speed) ease;
		}

		header {
			background-color: var(--header-bg);
			padding: 20px;
			text-align: center;
			border-radius: 10px 10px 0 0;
			transition: background-color var(--transition-speed) ease;
			position: relative;
			border: 2px solid #000;
		}

		h1 {
			color: var(--text-color);
			margin: 0;
			font-family: var(--title-font-family);
			font-size: var(--title-font-size);
			font-weight: bold;
			text-transform: uppercase;
			letter-spacing: var(--title-letter-spacing);
			text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
			transition: color var(--transition-speed) ease;
		}

		nav {
			display: flex;
			justify-content: center;
			background-color: var(--header-bg);
			padding: 10px;
			gap: 10px;
			flex-wrap: wrap;
			transition: background-color var(--transition-speed) ease;
		}

		nav button {
			padding: 10px 15px;
			border: none;
			border-radius: 5px;
			background-color: var(--neutral-color);
			color: white;
			cursor: pointer;
			transition: background-color var(--transition-speed) ease, transform 0.2s ease;
			min-width: 44px;
			min-height: 44px;
			display: flex;
			align-items: center;
			justify-content: center;
			font-size: 16px;
		}

		nav button:hover {
			background-color: var(--button-hover);
			transform: scale(1.05);
		}

		nav button:focus {
			outline: 2px solid var(--focus-outline);
			outline-offset: 2px;
		}

		main {
			display: flex;
			flex-direction: column;
			padding: 20px;
			gap: 20px;
		}

		.text-input-section,
		.analysis-section {
			background-color: var(--card-bg);
			border-radius: 8px;
			padding: 20px;
			box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
			transition: transform var(--transition-speed) ease, box-shadow var(--transition-speed) ease, background-color var(--transition-speed) ease;
		}

		.text-input-section h2,
		.analysis-section h2 {
			font-size: 1.8em;
			margin-bottom: 15px;
			text-align: center;
			color: var(--text-color);
		}

		.textarea-container {
			width: 100%;
			margin-bottom: 20px;
		}

		.textarea-container textarea {
			width: 100%;
			height: 200px;
			padding: 10px;
			border-radius: 5px;
			border: 1px solid #ddd;
			font-size: 16px;
			resize: vertical;
			font-family: 'Verdana', sans-serif;
			transition: border-color var(--transition-speed) ease;
			background-color: var(--bg-color);
			color: var(--text-color);
		}

		.textarea-container textarea:hover,
		.textarea-container textarea:focus {
			border-color: var(--neutral-color);
			outline: none;
		}

		.analyze-button,
		.btn-export {
			display: block;
			width: 100%;
			padding: 10px;
			margin-top: 10px;
			border: none;
			border-radius: 5px;
			background-color: var(--neutral-color);
			color: white;
			font-size: 16px;
			cursor: pointer;
			transition: background-color var(--transition-speed) ease, transform 0.2s ease;
		}

		.analyze-button:hover,
		.btn-export:hover {
			background-color: var(--button-hover);
			transform: scale(1.02);
		}

		.analyze-button:focus,
		.btn-export:focus {
			outline: 2px solid var(--focus-outline);
			outline-offset: 2px;
		}

		.analysis-result {
			margin-top: 20px;
			padding: 15px;
			border-radius: 5px;
			background-color: var(--bg-color);
			white-space: pre-wrap;
			overflow-wrap: break-word;
		}

		.highlight {
			font-weight: bold;
			padding: 2px 4px;
			border-radius: 3px;
			position: relative;
			cursor: pointer;
		}

		.visual-word {
			background-color: var(--visual-color);
			color: white;
		}

		.auditory-word {
			background-color: var(--auditory-color);
			color: white;
		}

		.kinesthetic-word {
			background-color: var(--kinesthetic-color);
			color: white;
		}

		.auditory-digital-word {
			background-color: var(--auditory-digital-color);
			color: white;
		}

		.entity-word {
			background-color: var(--entity-color);
			color: white;
		}

		.stats-section {
			display: flex;
			justify-content: space-around;
			margin-top: 20px;
			flex-wrap: wrap;
			gap: 10px;
		}

		.stat-item {
			text-align: center;
			padding: 10px;
			background-color: var(--card-bg);
			border-radius: 5px;
			box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
			flex: 1 1 150px;
		}

		.sequence-analysis,
		.entity-analysis,
		.vak-words-section,
		.chart-container {
			margin-top: 20px;
			padding: 15px;
			background-color: var(--bg-color);
			border-radius: 5px;
		}

		/* Modal Styles */
		.modal {
			display: none;
			position: fixed;
			z-index: 1000;
			left: 0;
			top: 0;
			width: 100%;
			height: 100%;
			overflow: auto;
			background-color: var(--modal-bg);
			transition: opacity var(--transition-speed) ease;
		}

		.modal-content {
			background-color: var(--card-bg);
			margin: 10% auto;
			padding: 20px;
			border: 1px solid #888;
			width: 90%;
			max-width: 500px;
			border-radius: 10px;
			position: relative;
			box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
			animation: fadeIn var(--transition-speed) ease;
			transition: background-color var(--transition-speed) ease;
			font-family: 'Verdana', sans-serif;
		}

		.close {
			color: #aaa;
			position: absolute;
			top: 10px;
			right: 20px;
			font-size: 28px;
			font-weight: bold;
			cursor: pointer;
			transition: color var(--transition-speed) ease;
		}

		.close:hover,
		.close:focus {
			color: black;
			text-decoration: none;
			cursor: pointer;
		}

		@keyframes fadeIn {
			from {
				opacity: 0;
				transform: translateY(-20px);
			}

			to {
				opacity: 1;
				transform: translateY(0);
			}
		}

		/* Tooltip Styles */
		.highlight[data-tooltip]::after {
			content: attr(data-tooltip);
			position: absolute;
			bottom: 125%;
			left: 50%;
			transform: translateX(-50%);
			background-color: var(--tooltip-bg);
			color: var(--tooltip-text);
			padding: 5px;
			border-radius: 6px;
			white-space: nowrap;
			opacity: 0;
			transition: opacity var(--transition-speed) ease;
			pointer-events: none;
			z-index: 1001;
		}

		.highlight[data-tooltip]::before {
			content: "";
			position: absolute;
			top: 100%;
			left: 50%;
			margin-left: -5px;
			border-width: 5px;
			border-style: solid;
			border-color: var(--tooltip-bg) transparent transparent transparent;
			opacity: 0;
			transition: opacity var(--transition-speed) ease;
			pointer-events: none;
			z-index: 1001;
		}

		.highlight[data-tooltip]:hover::after,
		.highlight[data-tooltip]:hover::before {
			opacity: 1;
		}

		/* Optimizaci√≥n Responsive */
		@media (max-width: 768px) {
			.container {
				padding: 10px;
			}

			h1 {
				font-size: 1.8em;
			}

			.text-input-section textarea {
				height: 150px;
			}

			.stats-section {
				flex-direction: column;
				align-items: center;
			}

			.stat-item {
				width: 100%;
				margin-bottom: 10px;
			}

			.analyze-button,
			.btn-export {
				width: 100%;
			}

			.modal-content {
				margin: 20% auto;
			}
		}

		/* Sem√°ntica y Accesibilidad */
		.sr-only {
			position: absolute;
			width: 1px;
			height: 1px;
			padding: 0;
			margin: -1px;
			overflow: hidden;
			clip: rect(0, 0, 0, 0);
			white-space: nowrap;
			border: 0;
		}
	</style>
</head>

<body>
	<div class="container">
		<header>
			<h1>Analizador VAK Mejorado con TextRazor</h1>
		</header>
		<nav>
			<button id="toggle-theme" aria-label="Alternar modo oscuro">üåô Modo Oscuro</button>
			<button id="show-info" aria-label="Mostrar informaci√≥n">‚ÑπÔ∏è Informaci√≥n</button>
			<button id="show-stats" aria-label="Mostrar estad√≠sticas">üìä Estad√≠sticas</button>
		</nav>
		<main>
			<section class="text-input-section">
				<h2>Ingrese su texto para analizar</h2>
				<div class="textarea-container">
					<label for="text-input" class="sr-only">Ingresa tu texto aqu√≠</label>
					<textarea id="text-input" placeholder="Escriba o pegue su texto aqu√≠..." aria-label="√Årea de texto para ingresar el discurso"></textarea>
				</div>
				<button id="analyze-btn" class="analyze-button" aria-label="Analizar texto">Analizar Texto</button>
			</section>
			<section class="analysis-section">
				<h2>Resultado del An√°lisis</h2>
				<div id="analysis-result" class="analysis-result">
					El texto analizado aparecer√° aqu√≠...
				</div>
				<div class="stats-section">
					<div class="stat-item">
						<h3>Visual</h3>
						<p id="visual-count">0</p>
					</div>
					<div class="stat-item">
						<h3>Auditivo</h3>
						<p id="auditory-count">0</p>
					</div>
					<div class="stat-item">
						<h3>Kinest√©sico</h3>
						<p id="kinesthetic-count">0</p>
					</div>
					<div class="stat-item">
						<h3>Auditivo Digital</h3>
						<p id="auditory-digital-count">0</p>
					</div>
				</div>
				<div class="sequence-analysis">
					<h3>An√°lisis de Secuencia</h3>
					<p id="sequence-result">La secuencia predominante aparecer√° aqu√≠...</p>
				</div>
				<div class="vak-words-section">
					<!-- Las listas de palabras VAK aparecer√°n aqu√≠ -->
				</div>
				<div class="entity-analysis">
					<h3>Entidades Nombradas</h3>
					<p id="entity-result">Las entidades identificadas aparecer√°n aqu√≠...</p>
				</div>
				<div class="chart-container">
					<canvas id="vakChart" width="400" height="200"></canvas>
				</div>
			</section>
			<button class="btn-export" id="export-results" aria-label="Exportar resultados">Exportar Resultados</button>
		</main>
	</div>

	<!-- Modal de Estad√≠sticas -->
	<div id="stats-modal" class="modal" aria-hidden="true" role="dialog" aria-labelledby="stats-title"
		aria-modal="true">
		<div class="modal-content">
			<span class="close" aria-label="Cerrar">&times;</span>
			<div class="stats-content" id="stats-content">
				<h2 id="stats-title">üìä Estad√≠sticas de Usuario</h2>
				<p>Textos Analizados: <span id="texts-analyzed">0</span></p>
				<p>Palabras Visuales: <span id="visual-count-modal">0</span></p>
				<p>Palabras Auditivas: <span id="auditory-count-modal">0</span></p>
				<p>Palabras Kinest√©sicas: <span id="kinesthetic-count-modal">0</span></p>
				<p>Palabras Auditivo Digital: <span id="auditory-digital-count-modal">0</span></p>
			</div>
		</div>
	</div>

	<!-- Modal Informativo -->
	<div id="info-modal" class="modal" aria-hidden="true" role="dialog" aria-labelledby="info-title" aria-modal="true">
		<div class="modal-content">
			<span class="close" aria-label="Cerrar">&times;</span>
			<h2 id="info-title">‚ÑπÔ∏è Informaci√≥n sobre el Analizador VAK Mejorado</h2>
			<p>El Analizador VAK es una herramienta dise√±ada para identificar elementos sensoriales en textos, bas√°ndose
				en el modelo de Programaci√≥n Neuroling√º√≠stica (PNL) que clasifica la percepci√≥n en cuatro sistemas
				principales: Visual, Auditivo, Kinest√©sico y Auditivo Digital.</p>
			<h3>C√≥mo funciona:</h3>
			<ul>
				<li><strong>Visual:</strong> Identifica palabras relacionadas con la vista y las im√°genes mentales.</li>
				<li><strong>Auditivo:</strong> Detecta t√©rminos asociados con el sonido y la escucha.</li>
				<li><strong>Kinest√©sico:</strong> Reconoce palabras vinculadas a sensaciones y emociones.</li>
				<li><strong>Auditivo Digital:</strong> Detecta t√©rminos relacionados con el pensamiento l√≥gico y
					anal√≠tico.</li>
			</ul>
			<p>Adem√°s, utilizando la API de TextRazor, el analizador identifica entidades nombradas y relaciones
				sem√°nticas para enriquecer el an√°lisis y proporcionar una comprensi√≥n m√°s profunda del texto.</p>
		</div>
	</div>

	<!-- Incluimos la biblioteca Chart.js -->
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

	<script>
		// Funci√≥n para escapar caracteres especiales en expresiones regulares
        function escapeRegExp(string) {
            return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }

        // *** Las siguientes l√≠neas deben ser definidas en otro archivo y copiadas aqu√≠ ***
		const visualPatterns = [
		/\b(visual\w*)\b/gi,
		/\b(clar\w*)\b/gi,
		/\b(vid\w*)\b/gi,
		/\b(mir\w*)\b/gi,
		/\b(observ\w*)\b/gi,
		/\b(enfoc\w*)\b/gi,
		/\b(perspect\w*)\b/gi,
		/\b(imagen\w*)\b/gi,
		/\b(color\w*)\b/gi,
		/\b(aparienc\w*)\b/gi,
		/\b(sombr\w*)\b/gi,
		/\b(visualizar\w*)\b/gi,
		/\b(ilumin\w*)\b/gi,
		/\b(visi√≥n)\b/gi,
		/\b(ver)\b/gi,
		/\b(visto)\b/gi,
		/\b(veo)\b/gi,
		/\b(distinguir\w*)\b/gi,
		/\b(vislumbr\w*)\b/gi,
		/\b(espej\w*)\b/gi,
		/\b(claridad)\b/gi,
		/\b(captar)\b/gi,
		/\b(retina\w*)\b/gi,
		/\b(percept\w*)\b/gi,
		/\b(n√≠tido\w*)\b/gi,
		/\b(fantasma\w*)\b/gi,
		/\b(enmarcar\w*)\b/gi,
		/\b(destacar\w*)\b/gi,
		/\b(aparici√≥n\w*)\b/gi,
		/\b(panorama\w*)\b/gi,
		/\b(visibilidad)\b/gi,
		/\b(paleta)\b/gi,
		/\b(transparente\w*)\b/gi,
		/\b(caleidoscopio)\b/gi,
		/\b(brill\w*)\b/gi,
		/\b(visualizaci√≥n\w*)\b/gi,
		/\b(reflejar\w*)\b/gi,
		/\b(proyecci√≥n)\b/gi,
		/\b(exhibir)\b/gi,
		/\b(deslumbre)\b/gi,
		/\b(difuminar)\b/gi,
		/\b(fundirse)\b/gi,
		/\b(prism√°tico)\b/gi,
		/\b(cinematogr√°fico)\b/gi,
		/\b(enfoque)\b/gi,
		/\b(captura\w*)\b/gi,
		/\b(√≥ptico)\b/gi,
		/\b(luz)\b/gi,
		/\b(sombra)\b/gi,
		/\b(colores?)\b/gi,
		/\b(cuadro)\b/gi
		];
		
		const auditoryPatterns = [
		/\b(audit\w*)\b/gi,
		/\b(sonid\w*)\b/gi,
		/\b(escuch\w*)\b/gi,
		/\b(o[i|√≠|y]r\w*)\b/gi,
		/\b(habl\w*)\b/gi,
		/\b(sonar\w*)\b/gi,
		/\b(reson\w*)\b/gi,
		/\b(ruido\w*)\b/gi,
		/\b(silenci\w*)\b/gi,
		/\b(susurr\w*)\b/gi,
		/\b(melod\w*)\b/gi,
		/\b(cantar\w*)\b/gi,
		/\b(grit\w*)\b/gi,
		/\b(decir\w*)\b/gi,
		/\b(escucho)\b/gi,
		/\b(discurs\w*)\b/gi,
		/\b(alboroto\w*)\b/gi,
		/\b(exclam\w*)\b/gi,
		/\b(voz)\b/gi,
		/\b(dialo\w*)\b/gi,
		/\b(rugido)\b/gi,
		/\b(zumbido)\b/gi,
		/\b(eco)\b/gi,
		/\b(rumor)\b/gi,
		/\b(chirrido\w*)\b/gi,
		/\b(resonar)\b/gi,
		/\b(repique\w*)\b/gi,
		/\b(armon√≠a)\b/gi,
		/\b(repetir)\b/gi,
		/\b(conversar\w*)\b/gi,
		/\b(murmullo)\b/gi,
		/\b(fonema)\b/gi,
		/\b(susurro)\b/gi,
		/\b(estallido)\b/gi,
		/\b(bisbisear)\b/gi,
		/\b(cacofon√≠a)\b/gi,
		/\b(ritmo)\b/gi,
		/\b(entonaci√≥n)\b/gi,
		/\b(palpitar)\b/gi,
		/\b(claquetazo)\b/gi,
		/\b(gru√±ido)\b/gi,
		/\b(reverberar)\b/gi,
		/\b(batir)\b/gi,
		/\b(tronido)\b/gi,
		/\b(cuchicheo)\b/gi,
		/\b(timbre)\b/gi,
		/\b(tronar)\b/gi,
		/\b(cloqueo)\b/gi,
		/\b(implosi√≥n)\b/gi,
		/\b(aplaudir)\b/gi,
		/\b(sonido\w*)\b/gi
		];
		
		const kinestheticPatterns = [
		/\b(sent\w*)\b/gi,
		/\b(tocar\w*)\b/gi,
		/\b(sensac\w*)\b/gi,
		/\b(mov\w*)\b/gi,
		/\b(camin\w*)\b/gi,
		/\b(correr\w*)\b/gi,
		/\b(calor\w*)\b/gi,
		/\b(fr[i|√≠]o\w*)\b/gi,
		/\b(presi[√≥|o]n\w*)\b/gi,
		/\b(fuerz\w*)\b/gi,
		/\b(sostener\w*)\b/gi,
		/\b(tens[√≥|o]n\w*)\b/gi,
		/\b(agarra\w*)\b/gi,
		/\b(golpe\w*)\b/gi,
		/\b(palpit\w*)\b/gi,
		/\b(siento)\b/gi,
		/\b(apretar)\b/gi,
		/\b(manzana)\b/gi,
		/\b(saltar)\b/gi,
		/\b(temblar)\b/gi,
		/\b(flexionar)\b/gi,
		/\b(frotar)\b/gi,
		/\b(aferrar)\b/gi,
		/\b(aliviar)\b/gi,
		/\b(empujar)\b/gi,
		/\b(estirar)\b/gi,
		/\b(levantar)\b/gi,
		/\b(tacto)\b/gi,
		/\b(escalar)\b/gi,
		/\b(carga)\b/gi,
		/\b(sostenido)\b/gi,
		/\b(relajar)\b/gi,
		/\b(tensar)\b/gi,
		/\b(pellizco)\b/gi,
		/\b(quemar)\b/gi,
		/\b(escalofr√≠o)\b/gi,
		/\b(sudor)\b/gi,
		/\b(aflojar)\b/gi,
		/\b(erizar)\b/gi,
		/\b(torcer)\b/gi,
		/\b(girar)\b/gi,
		/\b(caer)\b/gi,
		/\b(retorcer)\b/gi,
		/\b(abrazar)\b/gi,
		/\b(caminar)\b/gi,
		/\b(rodar)\b/gi,
		/\b(sacudir)\b/gi,
		/\b(presi√≥n)\b/gi,
		/\b(debilitar)\b/gi,
		/\b(empapar)\b/gi
		];
    
	const auditoryDigitalPatterns = [
	/\b(pens\w*)\b/gi, // pensar, pensamiento
	/\b(concept\w*)\b/gi, // concepto, conceptualizar
	/\b(entend\w*)\b/gi, // entender, entendimiento
	/\b(comprend\w*)\b/gi, // comprender, comprensi√≥n
	/\b(conoc\w*)\b/gi, // conocer, conocimiento
	/\b(l√≥gic\w*)\b/gi, // l√≥gica, l√≥gico
	/\b(analiz\w*)\b/gi, // analizar, an√°lisis
	/\b(proces\w*)\b/gi, // procesar, proceso
	/\b(sistem\w*)\b/gi, // sistema, sistem√°tico
	/\b(calcul\w*)\b/gi, // calcular, c√°lculo
	/\b(estudi\w*)\b/gi, // estudiar, estudio
	/\b(cuestion\w*)\b/gi, // cuestionar, cuesti√≥n
	/\b(inform\w*)\b/gi, // informar, informaci√≥n
	/\b(decid\w*)\b/gi, // decidir, decisi√≥n
	/\b(plane\w*)\b/gi, // planear, plan
	/\b(razon\w*)\b/gi, // razonar, razonamiento
	/\b(ideas?)\b/gi, // idea, ideas
	/\b(pensamiento)\b/gi, // pensamiento
	/\b(explic\w*)\b/gi, // explicar, explicaci√≥n
	/\b(deliberar)\b/gi, // deliberar
	/\b(teor√≠a)\b/gi, // teor√≠a
	/\b(estrateg\w*)\b/gi, // estrategia, estrat√©gico
	/\b(objetivo\w*)\b/gi, // objetivo, objetivamente
	/\b(deducc\w*)\b/gi, // deducci√≥n, deducir
	/\b(planear)\b/gi, // planear
	/\b(intelectual\w*)\b/gi, // intelectual
	/\b(memoria)\b/gi, // memoria
	/\b(cognoscitiv\w*)\b/gi, // cognoscitivo
	/\b(esquema)\b/gi, // esquema
	/\b(calcular)\b/gi, // calcular
	/\b(reflexionar)\b/gi, // reflexionar, reflexi√≥n
	/\b(proyectar)\b/gi, // proyectar
	/\b(hip√≥tesis)\b/gi, // hip√≥tesis
	/\b(verificar)\b/gi, // verificar
	/\b(formular)\b/gi, // formular
	/\b(definir)\b/gi, // definir, definici√≥n
	/\b(organizar)\b/gi, // organizar, organizaci√≥n
	/\b(decodificar)\b/gi, // decodificar
	/\b(elaborar)\b/gi, // elaborar
	/\b(conceptualizar)\b/gi, // conceptualizar
	/\b(determinar)\b/gi, // determinar
	/\b(examinar)\b/gi, // examinar, examen
	/\b(estudio)\b/gi, // estudio
	/\b(pronosticar)\b/gi, // pronosticar, pron√≥stico
	/\b(criterio)\b/gi, // criterio
	/\b(sintetizar)\b/gi, // sintetizar
	/\b(hipot√©tico)\b/gi, // hipot√©tico
	/\b(anticipar)\b/gi, // anticipar, anticipaci√≥n
	/\b(te√≥rico)\b/gi, // te√≥rico
	/\b(argumentar)\b/gi // argumentar, argumento
	];

        // Variables de Usuario
        let userStats = {
            textsAnalyzed: 0,
            visualCount: 0,
            auditoryCount: 0,
            kinestheticCount: 0,
            auditoryDigitalCount: 0
        };

        // Inicializaci√≥n del Gr√°fico
        let vakChart;

        async function analyzeText() {
            const textInput = document.getElementById('text-input').value;
            if (!textInput.trim()) {
                alert("Por favor, ingresa un texto para analizar.");
                return;
            }

            // Analizar el texto localmente para detectar palabras VAK
            const analysis = highlightText(textInput);
            document.getElementById('analysis-result').innerHTML = analysis.highlighted;

            // Actualizar estad√≠sticas
            userStats.textsAnalyzed++;
            userStats.visualCount += analysis.visualCount;
            userStats.auditoryCount += analysis.auditoryCount;
            userStats.kinestheticCount += analysis.kinestheticCount;
            userStats.auditoryDigitalCount += analysis.auditoryDigitalCount;
            updateStats();

            // Mostrar secuencia VAK
            const sequence = getSequence(textInput);
            document.getElementById('sequence-result').textContent = `Secuencia VAK: ${sequence.join(' ‚ûî ')}`;

            // Mostrar listas de palabras VAK
            displayVAKWords(analysis);

            // Actualizar gr√°fico
            updateChart(analysis);

            // An√°lisis adicional con TextRazor
            await analyzeWithTextRazor(textInput);
        }

        function highlightText(text) {
            let visualCount = 0;
            let auditoryCount = 0;
            let kinestheticCount = 0;
            let auditoryDigitalCount = 0;

            // Tokenizar el texto para evitar reemplazos dentro de etiquetas HTML
            const tokens = text.split(/(\s+|\n|<br>)/);

            // Orden de categor√≠as para evitar superposiciones
            const categories = [
                { patterns: auditoryDigitalPatterns, class: 'auditory-digital-word', type: 'Auditivo Digital' },
                { patterns: visualPatterns, class: 'visual-word', type: 'Visual' },
                { patterns: auditoryPatterns, class: 'auditory-word', type: 'Auditivo' },
                { patterns: kinestheticPatterns, class: 'kinesthetic-word', type: 'Kinest√©sico' }
            ];

            const highlightedTokens = tokens.map(token => {
                if (/^\s+$/.test(token) || token === '\n' || token === '<br>') {
                    return token;
                }

                let matched = false;

                for (const category of categories) {
                    for (const pattern of category.patterns) {
                        if (pattern.test(token)) {
                            matched = true;

                            // Incrementar el contador correspondiente
                            if (category.type === 'Visual') visualCount++;
                            if (category.type === 'Auditivo') auditoryCount++;
                            if (category.type === 'Kinest√©sico') kinestheticCount++;
                            if (category.type === 'Auditivo Digital') auditoryDigitalCount++;

                            return `<span class="highlight ${category.class}" data-tooltip="${category.type}: ${token}">${token}</span>`;
                        }
                    }
                    if (matched) break;
                }

                return token;
            });

            const highlighted = highlightedTokens.join('');

            return { highlighted, visualCount, auditoryCount, kinestheticCount, auditoryDigitalCount };
        }

        function updateStats() {
            document.getElementById('texts-analyzed').textContent = userStats.textsAnalyzed;
            document.getElementById('visual-count').textContent = userStats.visualCount;
            document.getElementById('auditory-count').textContent = userStats.auditoryCount;
            document.getElementById('kinesthetic-count').textContent = userStats.kinestheticCount;
            document.getElementById('auditory-digital-count').textContent = userStats.auditoryDigitalCount;

            // Actualizar tambi√©n en el modal
            document.getElementById('visual-count-modal').textContent = userStats.visualCount;
            document.getElementById('auditory-count-modal').textContent = userStats.auditoryCount;
            document.getElementById('kinesthetic-count-modal').textContent = userStats.kinestheticCount;
            document.getElementById('auditory-digital-count-modal').textContent = userStats.auditoryDigitalCount;
        }

        function exportResults() {
            const analyzedText = document.getElementById('analysis-result').innerText;
            const sequence = document.getElementById('sequence-result').textContent;
            const entities = document.getElementById('entity-result').innerText;
            const vakWords = document.querySelector('.vak-words-section').innerText;
            const content = `Texto Analizado:\n${analyzedText}\n\n${sequence}\n\nEntidades:\n${entities}\n\nPalabras VAK:\n${vakWords}`;
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'resultado_vak.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const toggleButton = document.getElementById('toggle-theme');
            if (document.body.classList.contains('dark-mode')) {
                toggleButton.innerText = '‚òÄÔ∏è Modo Claro';
                toggleButton.setAttribute('aria-label', 'Alternar modo claro');
            } else {
                toggleButton.innerText = 'üåô Modo Oscuro';
                toggleButton.setAttribute('aria-label', 'Alternar modo oscuro');
            }
        }

        // Funci√≥n para mostrar estad√≠sticas
        function showStats() {
            showModal('stats-modal');
        }

        function showModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.style.display = 'block';
            modal.setAttribute('aria-hidden', 'false');
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.style.display = 'none';
            modal.setAttribute('aria-hidden', 'true');
        }

        // Cerrar modales al hacer clic en el bot√≥n de cerrar
        document.querySelectorAll('.close').forEach(closeBtn => {
            closeBtn.addEventListener('click', function () {
                const modal = this.closest('.modal');
                closeModal(modal.id);
            });
        });

        // Cerrar modales si el usuario hace clic fuera de ellos
        window.addEventListener('click', function (event) {
            document.querySelectorAll('.modal').forEach(modal => {
                if (event.target === modal) {
                    closeModal(modal.id);
                }
            });
        });

        // Detectar preferencia de color del sistema y ajustar autom√°ticamente
        function detectColorScheme() {
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.body.classList.add('dark-mode');
                document.getElementById('toggle-theme').innerText = '‚òÄÔ∏è Modo Claro';
                document.getElementById('toggle-theme').setAttribute('aria-label', 'Alternar modo claro');
            }
        }

        window.addEventListener('load', () => {
            detectColorScheme();
        });

        // Funci√≥n para mostrar listas de palabras VAK detectadas
        function displayVAKWords(analysis) {
            const vakWordsSection = document.querySelector('.vak-words-section');
            vakWordsSection.innerHTML = ''; // Limpiar contenido previo

            const categories = [
                { type: 'Visual', words: analysis.visualWords },
                { type: 'Auditivo', words: analysis.auditoryWords },
                { type: 'Kinest√©sico', words: analysis.kinestheticWords },
                { type: 'Auditivo Digital', words: analysis.auditoryDigitalWords }
            ];

            categories.forEach(category => {
                const categoryDiv = document.createElement('div');
                categoryDiv.classList.add('vak-category');

                const title = document.createElement('h3');
                title.textContent = `Palabras ${category.type}`;
                categoryDiv.appendChild(title);

                const wordList = document.createElement('p');
                wordList.textContent = category.words.join(', ') || 'Ninguna';
                categoryDiv.appendChild(wordList);

                vakWordsSection.appendChild(categoryDiv);
            });
        }

        function getSequence(text) {
            const words = text.toLowerCase().split(/\s+/);
            const sequence = [];
            const added = new Set();

            const categories = [
                { patterns: auditoryDigitalPatterns, symbol: 'AD' },
                { patterns: visualPatterns, symbol: 'V' },
                { patterns: auditoryPatterns, symbol: 'A' },
                { patterns: kinestheticPatterns, symbol: 'K' }
            ];

            words.forEach(word => {
                // Eliminar puntuaci√≥n
                const cleanWord = word.replace(/[.,!?;:()]+$/g, '').toLowerCase();
                for (const category of categories) {
                    for (const pattern of category.patterns) {
                        if (pattern.test(cleanWord) && !added.has(category.symbol)) {
                            sequence.push(category.symbol);
                            added.add(category.symbol);
                            break;
                        }
                    }
                }
            });

            return sequence;
        }

        function updateChart(analysis) {
            const ctx = document.getElementById('vakChart').getContext('2d');
            const data = {
                labels: ['Visual', 'Auditivo', 'Kinest√©sico', 'Auditivo Digital'],
                datasets: [{
                    label: 'Palabras VAK',
                    data: [analysis.visualCount, analysis.auditoryCount, analysis.kinestheticCount, analysis.auditoryDigitalCount],
                    backgroundColor: [
                        'rgba(0, 64, 255, 0.6)',
                        'rgba(161, 3, 3, 0.6)',
                        'rgba(1, 117, 100, 0.6)',
                        'rgba(255, 140, 0, 0.6)'
                    ],
                    borderColor: [
                        'rgba(0, 64, 255, 1)',
                        'rgba(161, 3, 3, 1)',
                        'rgba(1, 117, 100, 1)',
                        'rgba(255, 140, 0, 1)'
                    ],
                    borderWidth: 1
                }]
            };

            if (window.vakChart) {
                window.vakChart.data.datasets[0].data = data.datasets[0].data;
                window.vakChart.update();
            } else {
                window.vakChart = new Chart(ctx, {
                    type: 'bar',
                    data: data,
                    options: {
                        scales: {
                            y: { beginAtZero: true }
                        }
                    }
                });
            }
        }

        // Integraci√≥n con la API de TextRazor
        async function analyzeWithTextRazor(text) {
            try {
                // Reemplaza con la URL correcta de tu funci√≥n serverless
                const response = await fetch('/.netlify/functions/textrazor?text=' + encodeURIComponent(text), {
                    method: 'GET'
                });

                if (!response.ok) {
                    throw new Error('Error en la respuesta del servidor');
                }

                const data = await response.json();

                // Procesar y mostrar los resultados adicionales
                processTextRazorData(data);

            } catch (error) {
                console.error('Error al comunicarse con la funci√≥n serverless:', error);
                alert('Ocurri√≥ un error al analizar el texto.');
            }
        }

        function processTextRazorData(data) {
            if (!data.response) {
                alert('No se obtuvieron resultados de TextRazor.');
                return;
            }

            // Mostrar entidades nombradas sin resaltar en el texto
            const entities = data.response.entities || [];
            const uniqueEntities = new Set();
            entities.forEach(entity => {
                uniqueEntities.add(entity.matchedText);
            });

            const entityResult = Array.from(uniqueEntities).join(', ');
            document.getElementById('entity-result').textContent = `Entidades: ${entityResult}`;

            // Opcional: Mostrar temas principales
            const topics = data.response.topics || [];
            const topTopics = topics.slice(0, 5).map(topic => topic.label).join(', ');
            if (topTopics) {
                const topicElement = document.createElement('p');
                topicElement.textContent = `Temas Principales: ${topTopics}`;
                document.querySelector('.entity-analysis').appendChild(topicElement);
            }
        }

        // Event Listeners
        document.getElementById('analyze-btn').addEventListener('click', analyzeText);
        document.getElementById('export-results').addEventListener('click', exportResults);
        document.getElementById('toggle-theme').addEventListener('click', toggleDarkMode);
        document.getElementById('show-info').addEventListener('click', function () {
            showModal('info-modal');
        });
        document.getElementById('show-stats').addEventListener('click', showStats);
	</script>
</body>

</html>